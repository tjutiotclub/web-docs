# 数据类型基础

在程序中，控制结构决定“程序怎么跑”，  
而数据类型决定“数据在计算机里是什么样”。

在工程实践中，数据类型不仅影响：
- 取值范围
- 精度
- 内存占用  

还直接关系到**硬件寄存器、通信协议和运算结果的正确性**。

---

## 为什么工程中必须关心数据类型

在嵌入式和系统开发中：

- 数据最终会存放在寄存器或内存中
- 不同类型对应不同的位宽和编码方式
- 类型选择错误，程序**可能编译通过但结果完全错误**

因此，数据类型不是“语法细节”，而是**工程约束**。

---

## 整型的位宽概念（8 / 16 / 32 位）

整型本质上是：

> **用固定数量的二进制位表示整数**

| 位宽   | 比特数 | 常见用途                     |
| ------ | ------ | ---------------------------- |
| 8 位   | 8 bit  | 字节数据、通信、标志位       |
| 16 位  | 16 bit | 传感器数据、计数值           |
| 32 位  | 32 bit | 运算中间量、系统状态变量     |

---

## 标准定长整型（强烈推荐）

为了避免不同平台下 `int` 长度不一致的问题，  
工程中通常使用 **stdint.h** 中定义的定长整型：

| 类型        | 位宽 | 说明                     |
| ----------- | ---- | ------------------------ |
| int8_t      | 8    | 有符号 8 位整数          |
| uint8_t     | 8    | 无符号 8 位整数          |
| int16_t     | 16   | 有符号 16 位整数         |
| uint16_t    | 16   | 无符号 16 位整数         |
| int32_t     | 32   | 有符号 32 位整数         |
| uint32_t    | 32   | 无符号 32 位整数         |

---

## 有符号与无符号整数的区别

### 有符号整数（signed）

- 最高位作为符号位
- 可表示正数和负数

以 8 位为例：

```text
范围：-128 ～ +127
````

---

### 无符号整数（unsigned）

* 所有位都用于表示数值
* 只能表示非负数

```text
范围：0 ～ 255
```

---

### 工程注意事项

* 无符号数参与比较时**极易产生隐蔽错误**
* 无符号数下溢不会报错，只会“回绕”

```c
uint8_t a = 0;
a--;   // 结果为 255
```

---

## char 类型的基本认识

`char` 是 C 语言中**最小的地址单位**，通常为 1 字节。

| 类型            | 含义        |
| ------------- | --------- |
| char          | 字符 / 小整数  |
| signed char   | 有符号 8 位整数 |
| unsigned char | 无符号 8 位整数 |

工程中常见用途：

* ASCII 字符
* 字节数据
* 通信缓冲区

---

## 浮点数类型（float / double）

浮点数用于表示**带小数的数值**，其本质是：

> **科学计数法的二进制近似表示**

| 类型     | 位宽 | 精度特点      | 工程用途     |
| ------ | -- | --------- | -------- |
| float  | 32 | 精度有限，速度快  | 传感器、控制算法 |
| double | 64 | 精度更高，运算更慢 | 上位机、仿真计算 |

---

## 浮点数的工程特性

* 浮点数**无法精确表示所有小数**
* 不推荐直接使用 `==` 比较
* 浮点运算消耗更多计算资源

```c
if (fabs(a - b) < 1e-6)
{
    // 认为相等
}
```

---

## 位运算基础（工程核心能力）

位运算直接作用于二进制位，是嵌入式中极其重要的工具。

| 运算符 | 含义   | 工程用途   |
| --- | ---- | ------ |
| &   | 按位与  | 清零、掩码  |
| \|   | 按位或 |置位      |
| ^   | 按位异或 | 翻转     |
| <<  | 左移   | 放大、位定位 |
| >>  | 右移   | 缩小、位提取 |

---

### 示例：设置和清除某一位

```c
// 设置第 3 位
x |= (1 << 3);

// 清除第 3 位
x &= ~(1 << 3);
```

---

## 数据类型与硬件的关系

在嵌入式系统中：

* 寄存器宽度决定高效的数据类型
* 通信协议规定字段位宽
* 类型不匹配可能导致数据错位或溢出

因此：

> **类型选择是硬件接口设计的一部分**

---

## 常见工程误区

1. 使用 `int` 假设其位宽固定
2. 混用有符号与无符号类型
3. 忽略浮点精度误差
4. 用浮点数完成本可用整数实现的逻辑

---

## 小结

* 数据类型定义了数据的**位宽、范围和语义**
* 定长整型是工程首选
* 浮点数是近似工具，而非精确数
* 位运算是连接软件与硬件的桥梁

理解数据类型，意味着你开始真正站在**计算机和硬件的视角**看待程序。

# 循环结构 —— for / while / do-while

循环结构用于让程序**重复执行一段代码**，是构成程序执行节奏的基础。  
在 C 语言中，主要提供三种循环结构：`for`、`while` 和 `do-while`。

它们在语法上相似，但在**语义、执行时机和工程用途**上存在明确差异。

---

## 三种循环结构对比（核心区分）

| 循环类型   | 判断时机           | 至少执行一次 | 典型用途                     | 工程语义关键词 |
| ---------- | ------------------ | ------------ | ---------------------------- | -------------- |
| for        | 循环开始前         | 否           | 次数确定的循环               | 计数、遍历     |
| while      | 循环开始前         | 否           | 条件驱动的循环               | 等待、轮询     |
| do-while  | 循环执行后         | 是           | 必须先执行一次的循环         | 先执行再判断   |

**这一表是理解循环结构的核心。**

---

## for 循环

### 基本形式

```c
for (init; condition; step)
{
    // 循环体
}
````

### 执行流程

1. 执行初始化语句 `init`
2. 判断 `condition`
3. 条件成立 → 执行循环体
4. 执行 `step`
5. 返回步骤 2

---

### 工程语义

`for` 循环表达的是：

> **“我明确知道要循环多少次”**

典型用途包括：

* 数组遍历
* 固定次数采样
* 表格计算
* 初始化操作

---

### 示例

```c
for (int i = 0; i < 10; i++)
{
    sum += i;
}
```

---

## while 循环

### 基本形式

```c
while (condition)
{
    // 循环体
}
```

### 执行流程

1. 判断 `condition`
2. 条件成立 → 执行循环体
3. 执行完成后再次判断

---

### 工程语义

`while` 循环表达的是：

> **“只要条件满足，就持续执行”**

典型用途包括：

* 等待外部条件
* 轮询硬件状态
* 主循环结构
* 阻塞式等待

---

### 示例（嵌入式常见）

```c
while (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0) == GPIO_PIN_RESET)
{
    // 等待按键按下
}
```

---

## do-while 循环

### 基本形式

```c
do
{
    // 循环体
}
while (condition);
```

⚠️ 注意：结尾必须有分号。

---

### 执行流程

1. 先执行一次循环体
2. 判断 `condition`
3. 条件成立 → 再次执行循环体

---

### 工程语义

`do-while` 表达的是：

> **“无论如何，先执行一次”**

典型用途包括：

* 至少执行一次的交互流程
* 菜单系统
* 首次采样不可跳过的逻辑

---

### 示例

```c
do
{
    read_sensor();
}
while (sensor_not_ready);
```

---

## 三种循环的工程对比总结

| 对比点    | for  | while | do-while  |
| ------ | ---- | ----- | --------- |
| 是否适合计数 | 非常适合 | 不适合   | 不适合       |
| 是否适合轮询 | 不推荐  | 推荐    | 有条件推荐     |
| 主循环使用  | 不常用  | 非常常用  | 特殊场景      |
| 可读性    | 结构紧凑 | 条件清晰  | 容易被忽略判断位置 |

---

## 与系统执行节奏的关系

在嵌入式系统中，循环往往意味着：

* CPU 时间占用
* 执行节奏控制
* 系统响应能力

特别是：

```c
while (1)
{
    // 主循环
}
```

该结构构成了最基础的**软件调度框架**。

---

## 常见工程误区

1. 在 `while` 中忘记更新条件，导致死循环
2. 用 `for` 实现条件等待，语义不清
3. 忽略 `do-while` 末尾分号
4. 在循环中执行耗时操作，影响系统实时性

---

## 小结

三种循环的本质区别不在语法，而在语义：

* `for`：**我知道要做多少次**
* `while`：**我不知道要多久，只知道什么时候停**
* `do-while`：**我必须先做一次**

理解这一点，才能在工程中正确选择循环结构，而不是“哪个顺手用哪个”。

# 选择与判断结构 —— if / else

在程序执行过程中，往往需要根据不同条件决定执行不同的代码路径。  
C 语言通过 `if / else` 结构实现最基本、也是最重要的**程序选择机制**。

---

## if / else 基本形式

基本语法形式如下：

```c
if (condition)
{
    // 条件成立时执行
}
else
{
    // 条件不成立时执行
}
````

其中 `condition` 为条件表达式，其结果将被判断为**真（非 0）或假（0）**。

---

## if / else 的功能作用

| 结构名  | if / else             |
| ---- | --------------------- |
| 结构作用 | 根据条件判断结果选择不同的执行路径     |
| 判断依据 | 条件表达式的逻辑结果（真 / 假）     |
| 执行特性 | 同一时刻只会执行其中一条分支        |
| 工程意义 | 构成状态判断、逻辑决策与控制流程的基础单元 |

---

## 条件表达式的判定规则

在 C 语言中：

* **0** 表示假（false）
* **非 0** 表示真（true）

例如：

```c
if (x)
```

等价于：

```c
if (x != 0)
```

常见条件表达式包括：

```c
a > b
a == b
a != b
flag == 1
```

---

## 多分支判断结构

当存在多个判断条件时，可以使用 `else if` 结构：

```c
if (x > 10)
{
    // 情况 1
}
else if (x > 5)
{
    // 情况 2
}
else
{
    // 其他情况
}
```

该结构从上到下依次判断，**一旦满足条件即执行并退出判断结构**。

---

## 函数工作原理

### 1. 功能行为层

从使用者角度看，`if / else` 的作用是：

* 在运行时对条件进行判断
* 根据判断结果选择代码执行路径

程序的执行不再是线性的，而是具有**分支结构**。

---

### 2. 控制流分析

从程序执行流程来看：

1. 程序执行到 `if` 语句
2. 计算条件表达式的结果
3. 根据结果跳转到对应代码块
4. 执行完成后继续向下执行

该过程本质上是一次**控制流的动态选择**。

---

### 3. 底层实现原理

在编译层面，`if / else` 通常会被转换为：

* 条件判断指令
* 条件跳转（branch）指令

例如在处理器层面：

* 条件不满足 → 跳转到 else 分支
* 条件满足 → 顺序执行 if 分支

因此，`if / else` 并不是“语法魔法”，而是对**CPU 分支跳转机制**的抽象封装。

---

### 4. 与硬件 / 系统的关系

在嵌入式系统中，`if / else` 常用于：

* GPIO 电平判断
* 传感器阈值检测
* 通信状态判断
* 系统运行模式切换

例如：

```c
if (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0) == GPIO_PIN_SET)
{
    // 按键被按下
}
```

此时，`if` 实际上承担的是**硬件状态解释器**的角色。

---

## 常见工程错误分析

### 1. 赋值符号与比较符号混淆

错误示例：

```c
if (a = 1)
```

正确写法：

```c
if (a == 1)
```

原因：
`=` 为赋值运算符，其结果为被赋的值，往往导致条件恒成立。

---

### 2. 浮点数直接比较

不推荐写法：

```c
if (x == 0.1f)
```

原因：
浮点数存在精度误差，直接比较可能导致判断失效。

推荐方式：

```c
if (fabs(x - 0.1f) < 1e-6)
```

---

## 典型应用场景

基于其工作原理，`if / else` 常用于：

* 状态机的基本判断单元
* 控制算法中的逻辑分支
* 错误检测与异常处理
* 人机交互输入判断

---

## 小结

`if / else` 的本质是：

> **在运行时根据条件结果动态改变程序的执行路径**

它是构成：

* 状态机
* 控制逻辑
* 调度判断

的最小结构单元，也是后续循环结构和系统逻辑的基础。

理解 `if / else`，等价于理解程序如何“做决定”。

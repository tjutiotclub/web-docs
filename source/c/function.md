# 函数（Function）

如果说前面的内容解决了“程序如何活着”，  
那么函数解决的是一个更高阶的问题：

> **程序如何有结构地生长。**

函数是 C 语言中最重要的“组织单位”，  
它让程序从一团线性代码，进化成可维护、可扩展的系统。

---

## 一、什么是函数

函数是一段**完成特定功能的代码集合**。

它的三个核心作用：

- 封装逻辑（把细节藏起来）
- 复用代码（写一次，用多次）
- 构建程序结构（模块化）

---

## 二、函数的基本结构

```c
返回类型 函数名(参数列表)
{
    函数体;
}
````

示例：

```c
int add(int a, int b)
{
    return a + b;
}
```

---

## 三、返回类型的意义

### 1. `void` 函数：不返回数据

```c
void led_on(void)
{
    HAL_GPIO_WritePin(GPIOA, GPIO_PIN_10, GPIO_PIN_SET);
}
```

特点：

* 只做事情
* 不“交付结果”
* 常用于：控制、初始化、状态修改

---

### 2. 有返回值的函数（如 `int`）

```c
int max(int a, int b)
{
    if (a > b)
        return a;
    else
        return b;
}
```

特点：

* 函数完成计算
* **通过 return 交付一个结果**
* 常用于：算法、判断、数值计算

---

### 3. `return` 的本质

* `return` 立即结束函数
* `return 值` 会把数据送回调用者
* `void` 函数中可以省略 return

---

## 四、函数参数：形参与实参

这是函数理解中**最容易混乱的一点**。

---

### 1. 实参（实际参数）

```c
int a = 3;
int b = 5;

add(a, b);
```

* 写在**函数调用时**
* 是实际参与计算的数据

---

### 2. 形参（形式参数）

```c
int add(int x, int y)
{
    return x + y;
}
```

* 写在**函数定义中**
* 是函数内部使用的“临时变量”

📌 **形参本质上是实参的副本（默认情况）**

---

## 五、值传递：索要数据本身

```c
void test(int x)
{
    x = 0;
}

int a = 10;
test(a);
```

结果：

```c
a == 10
```

原因：

* x 得到的是 a 的值拷贝
* 函数内部修改的是副本
* 原始数据不受影响

📌 适用场景：

* 只做计算
* 不需要修改外部变量

---

## 六、地址传递：索要数据的位置

```c
void test(int *x)
{
    *x = 0;
}

int a = 10;
test(&a);
```

结果：

```c
a == 0
```

原因：

* 传入的是 a 的地址
* `*x` 直接操作原始内存
* 修改立即生效

📌 适用场景：

* 修改变量
* 修改数组、结构体
* 返回多个结果

---

## 七、什么时候索要“数据”，什么时候索要“地址”

这是函数设计的**关键判断点**。

---

###  索要数据（值）

* 只关心结果
* 不希望函数产生副作用
* 数据体量小（int、float）

```c
int square(int x);
```

---

###  索要地址（指针）

* 需要修改原始数据
* 数据体量大（数组、结构体）
* 需要输出多个结果

```c
void normalize(float *x, float *y);
```

一句话总结：

> **函数要改你，就必须知道你住哪。**

---

## 八、函数与程序结构

良好的函数划分通常遵循：

* 一个函数只做一件事
* 函数名能说明功能
* 主函数（main）只负责调度

```c
int main(void)
{
    init_system();
    read_sensor();
    control_loop();
}
```

📌 主函数不应该塞满细节。

---

## 九、函数不是“跳转”，而是“接口”

不要把函数理解为“goto 的高级版”。

函数更像是：

* 对外暴露的能力
* 明确的输入
* 明确的输出
* 可预测的行为

这是工程代码可维护的根基。

